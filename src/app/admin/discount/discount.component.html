<app-header></app-header>
<app-left-menu></app-left-menu>
<div id="page-wrapper">
  <div id="page-inner">


    <div class="row">
      <div class="col-md-12">
        <h1 class="page-header">
          Discount Coupon
        </h1>
      </div>
    </div>
    <!-- /. ROW  -->


    <div class="row">
      <div class="col-md-12">
        <div class="text-right" style="margin-bottom:10px;">
          <button type="button" (click)="addCoupon(couponModal)" class="btn btn-success">
            <i class="fa fa-plus" aria-hidden="true"></i> Add Discount Coupon
          </button>
        </div>
        <div class="panel panel-default blogsTab">
          <div class="panel-heading">
            Total Discount Coupon - {{couponCount}}
          </div>
          <div class="panel-body">
            <div class="table-responsive">
              <div id="dataTable_wrapper" class="dataTables_wrapper form-inline" role="grid">
                <table class="table table-striped table-bordered table-hover dataTable no-footer"
                       id="dataTable" aria-describedby="dataTable_info">
                  <thead>
                  <tr role="row">
                    <th class="sorting_asc" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-sort="ascending"
                        aria-label="S No.: activate to sort column ascending" style="width: 22px;">S
                      No.
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-label="Title: activate to sort column ascending"
                        style="width: 353px;">Title
                    </th>
                    <!--<th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"-->
                        <!--colspan="1" aria-label="Slug: activate to sort column ascending"-->
                        <!--style="width: 336px;">Description-->
                    <!--</th>-->
                    <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-label="Status: activate to sort column ascending"
                        style="width: 62px;">Coupon
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-label="Created Date: activate to sort column ascending"
                        style="width: 52px;">Expired On
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-label="Created Date: activate to sort column ascending"
                        style="width: 52px;">Type
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-label="Created Date: activate to sort column ascending"
                        style="width: 52px;">Discount
                    </th>
                    <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                        colspan="1" aria-label="Actions: activate to sort column ascending"
                        style="width: 157px;">Created At
                    </th>
                      <th class="sorting" tabindex="0" aria-controls="dataTable" rowspan="1"
                          colspan="1" aria-label="Actions: activate to sort column ascending"
                          style="width: 157px;">Actions
                      </th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr *ngFor="let item of couponList; let i = index">
                    <td class="sorting_1">{{i + 1}}</td>
                    <td>{{item.title}}</td>
                    <!--<td>{{item.description | slice:0:30}}</td>-->
                    <td>{{item.token}}</td>
                      <td>{{item.expired_on === '2200-12-31 00:00:00' ? 'No expire' : item.expired_on}}</td>
                      <td>{{item.max_user === 9999999 ? 'Unlimited Use' : item.max_user > 1 ? item.max_user : 'Single Use'}}</td>
                    <td>{{item.flag === '1' ? '$'+item.amount : item.amount+'%'}}</td>
                    <td>{{item.created_at}}</td>
                    <td class="text-center ">
                      <button (click)="editCoupon(couponModal, i)" class="btn btn-info"><i
                              class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit</button>
                      <button class="btn btn-danger deleteAdminOption"
                         (click)="delCoupon(couponDelModal, i)">
                        <i class="fa fa-trash" aria-hidden="true"></i>
                        Delete
                      </button>
                        <button class="btn btn-warning deleteAdminOption"
                                (click)="viewUserModal(viewUser, i)">
                            <i class="fa fa-users" aria-hidden="true"></i>
                            Users {{item.user_package.length}}
                        </button>
                    </td>
                  </tr>
                  </tbody>
                </table>

                <!--<div class="row"><div class="col-sm-6"><div class="dataTables_info" id="dataTable_info" role="alert" aria-live="polite" aria-relevant="all">Showing 1 to 10 of 70 entries</div></div><div class="col-sm-6"><div class="dataTables_paginate paging_simple_numbers" id="dataTable_paginate"><ul class="pagination"><li class="paginate_button previous disabled" aria-controls="dataTable" tabindex="0" id="dataTable_previous"><a href="#">Previous</a></li><li class="paginate_button active" aria-controls="dataTable" tabindex="0"><a href="#">1</a></li><li class="paginate_button " aria-controls="dataTable" tabindex="0"><a href="#">2</a></li><li class="paginate_button " aria-controls="dataTable" tabindex="0"><a href="#">3</a></li><li class="paginate_button " aria-controls="dataTable" tabindex="0"><a href="#">4</a></li><li class="paginate_button " aria-controls="dataTable" tabindex="0"><a href="#">5</a></li><li class="paginate_button " aria-controls="dataTable" tabindex="0"><a href="#">6</a></li><li class="paginate_button " aria-controls="dataTable" tabindex="0"><a href="#">7</a></li><li class="paginate_button next" aria-controls="dataTable" tabindex="0" id="dataTable_next"><a href="#">Next</a></li></ul></div></div></div></div>-->
              </div>
            </div>
          </div>
        </div>
      </div>

        <ng-template #viewUser>
            <div class="adminModal">
                <div class="panel-body">
                    <div class="modal-header" style="margin-bottom:15px">
                        <h3 class="modal-title">
                            View User
                        </h3>
                        <button type="button" class="close" (click)="modalRef.hide()">×</button>
                    </div>
                    <div class="modal-body">
                        <table>
                            <thead>
                            <tr>
                                <th>Sl No.</th>
                                <th>Full Name</th>
                                <th>Email ID</th>
                            </tr>
                            </thead>
                            <tbody *ngIf="couponVal.user_package.length > 0">
                            <tr *ngFor="let pack of couponVal.user_package; let j = index;">
                                <td>{{j}}</td>
                                <td>{{pack.user.name}}</td>
                                <td>{{pack.user.email}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </ng-template>

      <ng-template #couponModal>
        <div class="adminModal">
          <div class="panel-body">
            <div class="modal-header" style="margin-bottom:15px">
              <h3 class="modal-title">
                {{editMode ? 'Edit': 'Add'}} Coupon
              </h3>
              <button type="button" class="close" (click)="modalRef.hide()">×</button>
            </div>
            <div *ngIf="!respType">
              <form [formGroup]="couponForm">
                <div class="modal-body">
                  <h4>Title:</h4>
                  <p>
                    <input class="form-control" formControlName="title">
                    <span *ngIf="couponForm.controls['title'].errors" style="color:red;"> Coupon title is required ! </span>
                  </p>
                </div>
                  <div class="modal-body">
                      <h4>Coupon Code:</h4>
                      <p>
                          <input class="form-control" formControlName="token" mask="AAAAAA" (keyup)="getValue($event.target.value)">
                          <span *ngIf="couponForm.controls['token'].errors" style="color:red;"> Coupon code must be six charecter ! </span>
                          <span *ngIf="errorTy" style="color:red;"> {{checkCodeMsg}} </span>
                          <span *ngIf="!errorTy" style="color:green;"> {{checkCodeMsg}} </span>
                      </p>
                  </div>
                <div class="modal-body">
                  <h4>Expired On:</h4>
                  <p>
                    <input type="text" bsDatepicker [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }" class="form-control" name="expired_on" formControlName="expired_on">
                    <span *ngIf="couponForm.get('expired_on').invalid" style="color:red;">
                  <p *ngIf="couponForm.get('expired_on').hasError('required')">Expire date is required ! </p>
                  </span>
                  </p>
                </div>
                <div class="modal-body">
                  <h4>Discount type:</h4>
                  <p>
                    <select class="form-control" formControlName="flag">
                      <option value="1">Flat Discount</option>
                      <option value="0">Percentage Discount</option>
                    </select>
                    <span *ngIf="couponForm.controls['flag'].errors" style="color:red;"> Coupon type is required ! </span>
                  </p>
                </div>
                <div class="modal-body">
                  <h4>Amount:</h4>
                  <p>
                    <input type="number" class="form-control" formControlName="amount" pattern="^\d+(\.\d+)?$">
                    <span *ngIf="couponForm.controls['amount'].errors" style="color:red;"> Coupon amount is required ! </span>
                  </p>
                </div>
                  <div class="modal-body">
                      <h4>Type:</h4>
                      <p>
                          <select class="form-control" formControlName="useType" (change)="usageTypeValid()">
                              <option [ngValue]="1">One Time Use</option>
                              <option [ngValue]="2">Multi Use</option>
                          </select>
                          <span *ngIf="couponForm.controls['useType'].errors" style="color:red;"> Use type is required ! </span>
                      </p>
                  </div>
                  <div *ngIf="couponForm.value.useType === 2">
                      <div class="modal-body">
                          <h4>Max User:</h4>
                          <p>
                              <select class="form-control" formControlName="usageType" #usageType (change)="maxUserValid(usageType.value)">
                                  <option [ngValue]="1">Unlimited Time User</option>
                                  <option  [ngValue]="2">Limited Time User</option>
                              </select>
                              <span *ngIf="couponForm.controls['usageType'].errors" style="color:red;"> Usage type is required ! </span>
                          </p>
                      </div>
                      <div class="modal-body" *ngIf="couponForm.get('usageType').value === 2">
                          <h4>Number of User:</h4>
                          <p>
                              <input type="number" class="form-control" formControlName="max_user" >
                              <span *ngIf="couponForm.controls['max_user'].errors" style="color:red;"> Maximum user should be greater than 2 for multiple time use ! </span>
                          </p>
                      </div>

                  </div>

                <div class="modal-body">
                  <button type="button" class="btn btn-primary" (click)="update()" [disabled]="couponForm.invalid"> {{editMode ? 'Update' : 'Add'}} Coupon</button>
                </div>
              </form>
              <!--{{couponForm.value | json}}-->
            </div>
            <div *ngIf="respType">
              <div class="modal-body">
                <p>{{respMsg}}</p>
              </div>
            </div>
          </div>
        </div>
      </ng-template>


      <ng-template #couponDelModal>
        <div class="adminModal">
          <div class="panel-body">
            <div class="modal-header" style="margin-bottom:15px">
              <h3 class="modal-title">
                {{respMsg}}
              </h3>
              <button type="button" class="close" (click)="modalRef.hide()">×</button>
            </div>
            <div class="modal-body" *ngIf="!respType">
              <button type="button" class="btn btn-warning" (click)="modalRef.hide()">
                Cancel
              </button>
              <button type="button" class="btn btn-danger" (click)="onitemDel()">
                Yes, Delete It!
              </button>
            </div>
          </div>
        </div>
      </ng-template>

      <footer><p>All right reserved. Developed By <a href="#">TNI</a></p></footer>
    </div>
    <!-- /. PAGE INNER  -->
  </div>
</div>